
CREATE PROCEDURE `PROC_VENTA`(
  IN PI_COD_INV BIGINT
, IN PI_COD_PERSONA BIGINT
, IN PI_COD_PRODUCTO BIGINT
, IN PV_NOM_PRODUCTO VARCHAR(20)
, IN PI_CANT_PRODUCTO INT(3)
, IN PI_PREC_UNITARIO INT(3)
, IN PI_TOTAL_BRUTO  INT(3)
, IN PV_DESTINO_VENTA VARCHAR(20)
, IN PI_IMPUE_TOTAL   INT(2)
, IN PI_TOTAL_VENTA INT(3)
, IN PV_OPERACION  VARCHAR(1)
, IN PI_FILA INT(1)
)
BEGIN
START TRANSACTION;
IF PV_OPERACION = 1 THEN
INSERT INTO  ventas(
   COD_INV
  ,COD_PERSONA
  ,COD_PRODUCTO
  ,NOM_PRODUCTO
  ,CANT_PRODUCTO
  ,PREC_UNITARIO
  ,TOTAL_BRUTO
  ,DESTINO_VENTA
  ,FEC_VENTA
  ,IMPUE_TOTAL
  ,TOTAL_VENTA
) VALUES (
   PI_COD_INV   
  ,PI_COD_PERSONA  
  ,PI_COD_PRODUCTO 
  ,PV_NOM_PRODUCTO
  ,PI_CANT_PRODUCTO
  ,PI_PREC_UNITARIO
  ,PI_TOTAL_BRUTO
  ,PV_DESTINO_VENTA
  ,NOW()
  ,PI_IMPUE_TOTAL
  ,PI_TOTAL_VENTA
);
-- Seleccionar el maximo insertado en la tabla de Ventas
SELECT @COD_VENTA := MAX(COD_VENTA) from VENTAS;
INSERT INTO  relveninv(
  COD_VENTA
  ,COD_INV
) VALUES (
  @COD_VENTA
 ,PI_COD_INV
);
INSERT INTO  relvenper(
  COD_VENTA
 ,COD_PERSONA
) VALUES (
  @COD_VENTA
 ,PI_COD_PERSONA
);
INSERT INTO  relvenprod(
   COD_VENTA
  ,COD_PRODUCTO
) VALUES (
  @COD_VENTA
 ,PI_COD_PRODUCTO
);
ELSEIF PV_OPERACION = 2 THEN
UPDATE ventas
SET
   COD_INV = PI_COD_INV   
  ,COD_PERSONA=PI_COD_PERSONA  
  ,COD_PRODUCTO = PI_COD_PRODUCTO 
  ,NOM_PRODUCTO = PV_NOM_PRODUCTO -- varchar(255)
  ,CANT_PRODUCTO = PI_CANT_PRODUCTO -- tinyint(4)
  ,PREC_UNITARIO = PI_PREC_UNITARIO -- tinyint(4)
  ,TOTAL_BRUTO = PI_TOTAL_BRUTO -- tinyint(4)
  ,DESTINO_VENTA = PV_DESTINO_VENTA -- varchar(255)
  ,FEC_VENTA = now() -- datetime
  ,IMPUE_TOTAL = PI_IMPUE_TOTAL  -- decimal(4,2)
  ,TOTAL_VENTA =  PI_TOTAL_VENTA   -- decimal(11,2)
WHERE COD_VENTA = PI_FILA;-- bigint(20)
ELSEIF PV_OPERACION = 3 THEN
DELETE FROM ventas 
WHERE COD_VENTA = PI_FILA;

ELSEIF PV_OPERACION = 4 THEN
SELECT COD_VENTA, COD_INV, COD_PERSONA, COD_PRODUCTO, NOM_PRODUCTO, CANT_PRODUCTO, PREC_UNITARIO, TOTAL_BRUTO, DESTINO_VENTA, FEC_VENTA, IMPUE_TOTAL, TOTAL_VENTA 
FROM ventas;
ELSEIF PV_OPERACION = 5 THEN
SELECT * FROM VENTAS WHERE COD_VENTA= PI_FILA;
END IF;
COMMIT;
END;
